apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.5
  creationTimestamp: null
  name: yurtclusters.operator.openyurt.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.phase
    name: PHASE
    type: string
  group: operator.openyurt.io
  names:
    kind: YurtCluster
    listKind: YurtClusterList
    plural: yurtclusters
    shortNames:
    - yc
    singular: yurtcluster
  scope: Cluster
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: YurtCluster is the Schema for the yurtclusters API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: YurtClusterSpec defines the desired state of YurtCluster
          properties:
            imageRepository:
              description: ImageRepository defines the image repository address
              type: string
            kubeAPIServer:
              description: KubeAPIServer defines the APIServer address of Kubernetes
                APIServer
              properties:
                domain:
                  description: Domain defines the domain name of Kubernetes APIServer
                  type: string
                publicIP:
                  description: PublicIP defines the public IP of Kubernetes APIServer
                  type: string
              type: object
            nodeLocalDNSCache:
              description: NodeLocalDNSCache defines the configuration for node local
                dns cache
              properties:
                enable:
                  description: Enable defines whether to enable the node local dns
                    cache
                  type: boolean
                image:
                  description: NodeLocalDNSImage defines the image full path for node
                    local dns
                  type: string
                nodeLocalAddress:
                  description: NodeLocalAddress defines the IP that the node local
                    dns will bind to
                  type: string
                upstreamPublicIP:
                  description: UpstreamPublicIP defines the public IP for cloud coredns
                    listen on
                  type: string
                upstreamPublicPort:
                  description: UpstreamPublicPort defines the public port for cloud
                    coredns listen on
                  type: integer
              type: object
            version:
              description: Version defines the version to deploy
              type: string
            yurtAppManager:
              description: YurtAppManager defines the configuration for yurt app manager
              properties:
                enableController:
                  description: EnableController defines whether to enable the yurt
                    app manager controller
                  type: boolean
                installCRD:
                  description: InstallCRD defines whether to install the yurt app
                    manager crd
                  type: boolean
                version:
                  description: Version defines the version of yurt app manager
                  type: string
              type: object
            yurtHub:
              description: YurtHub defines the configuration for yurt hub
              properties:
                accessServerThroughHub:
                  description: AccessServerThroughHub enables pods access kube-apiserver
                    through yurthub or not
                  type: boolean
                autoRestartNodePod:
                  description: AutoRestartNodePod represents whether to automatically
                    restart the pod after yurt-hub added or removed
                  type: boolean
                enableResourceFilter:
                  description: EnableResourceFilter enables to filter response that
                    comes back from reverse proxy
                  type: boolean
              type: object
            yurtTunnel:
              description: YurtTunnel defines the configuration for yurt tunnel
              properties:
                enable:
                  description: Enable defines whether to enable the yurt tunnel component
                  type: boolean
                publicIP:
                  description: PublicIP defines the public IP for tunnel server listen
                    on
                  type: string
                publicPort:
                  description: PublicPort defines the public port for tunnel server
                    listen on
                  type: integer
                serverCount:
                  description: ServerCount defines the replicas for the tunnel server
                    deployment Operator will automatically override this value if
                    it is less than the number of master node
                  type: integer
              type: object
          type: object
        status:
          description: YurtClusterStatus defines the observed state of YurtCluster
          properties:
            lastUpdateSpec:
              description: LastUpdateTime is the latest update spec by the operator
              properties:
                imageRepository:
                  description: ImageRepository defines the image repository address
                  type: string
                kubeAPIServer:
                  description: KubeAPIServer defines the APIServer address of Kubernetes
                    APIServer
                  properties:
                    domain:
                      description: Domain defines the domain name of Kubernetes APIServer
                      type: string
                    publicIP:
                      description: PublicIP defines the public IP of Kubernetes APIServer
                      type: string
                  type: object
                nodeLocalDNSCache:
                  description: NodeLocalDNSCache defines the configuration for node
                    local dns cache
                  properties:
                    enable:
                      description: Enable defines whether to enable the node local
                        dns cache
                      type: boolean
                    image:
                      description: NodeLocalDNSImage defines the image full path for
                        node local dns
                      type: string
                    nodeLocalAddress:
                      description: NodeLocalAddress defines the IP that the node local
                        dns will bind to
                      type: string
                    upstreamPublicIP:
                      description: UpstreamPublicIP defines the public IP for cloud
                        coredns listen on
                      type: string
                    upstreamPublicPort:
                      description: UpstreamPublicPort defines the public port for
                        cloud coredns listen on
                      type: integer
                  type: object
                version:
                  description: Version defines the version to deploy
                  type: string
                yurtAppManager:
                  description: YurtAppManager defines the configuration for yurt app
                    manager
                  properties:
                    enableController:
                      description: EnableController defines whether to enable the
                        yurt app manager controller
                      type: boolean
                    installCRD:
                      description: InstallCRD defines whether to install the yurt
                        app manager crd
                      type: boolean
                    version:
                      description: Version defines the version of yurt app manager
                      type: string
                  type: object
                yurtHub:
                  description: YurtHub defines the configuration for yurt hub
                  properties:
                    accessServerThroughHub:
                      description: AccessServerThroughHub enables pods access kube-apiserver
                        through yurthub or not
                      type: boolean
                    autoRestartNodePod:
                      description: AutoRestartNodePod represents whether to automatically
                        restart the pod after yurt-hub added or removed
                      type: boolean
                    enableResourceFilter:
                      description: EnableResourceFilter enables to filter response
                        that comes back from reverse proxy
                      type: boolean
                  type: object
                yurtTunnel:
                  description: YurtTunnel defines the configuration for yurt tunnel
                  properties:
                    enable:
                      description: Enable defines whether to enable the yurt tunnel
                        component
                      type: boolean
                    publicIP:
                      description: PublicIP defines the public IP for tunnel server
                        listen on
                      type: string
                    publicPort:
                      description: PublicPort defines the public port for tunnel server
                        listen on
                      type: integer
                    serverCount:
                      description: ServerCount defines the replicas for the tunnel
                        server deployment Operator will automatically override this
                        value if it is less than the number of master node
                      type: integer
                  type: object
              type: object
            lastUpdateTime:
              description: LastUpdateTime is the latest update time by the operator
              format: date-time
              type: string
            nodeConvertConditions:
              additionalProperties:
                description: NodeConvertCondition describes the state of a node at
                  a certain point.
                properties:
                  ackLastUpdateTime:
                    description: AckLastUpdateTime is the latest ack for the latest
                      update time set by the operator
                    format: date-time
                    type: string
                  lastTransitionTime:
                    description: The last time this condition was updated.
                    format: date-time
                    type: string
                  message:
                    description: A human readable message indicating details about
                      the transition.
                    type: string
                  reason:
                    description: The reason for the condition's last transition.
                    type: string
                  status:
                    description: The status for the condition's last transition.
                    type: string
                type: object
              description: NodeConvertConditions holds the info about node convert
                conditions
              type: object
            phase:
              description: Phase represents the current phase of the openyurt cluster
              type: string
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: yurt-operator-manager
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: yurt-operator-leader-election-role
  namespace: kube-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - configmaps/status
  verbs:
  - get
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: yurt-operator-manager-role
rules:
- apiGroups:
  - storage.k8s.io
  resources:
  - csidrivers
  - csinodes
  - volumeattachments
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - node.k8s.io
  resources:
  - runtimeclasses
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - node.k8s.io
  resources:
  - runtimeclasses
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - authorization.k8s.io
  resources:
  - localsubjectaccessreviews
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - apps.openyurt.io
  resources:
  - nodepools
  - uniteddeployments
  - nodepools/status
  - uniteddeployments/status
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - certificates.k8s.io
  resourceNames:
  - kubernetes.io/legacy-unknown
  resources:
  - signers
  verbs:
  - approve
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  - events.k8s.io
  resources:
  - events
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  - apps
  resources:
  - daemonsets
  - deployments
  - statefulsets
  - controllerrevisions
  - deployments/status
  - statefulsets/status
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - roles
  - rolebindings
  - clusterroles
  - clusterrolebindings
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - configmaps
  - services
  - pods
  - pods/status
  - pods/eviction
  - nodes
  - nodes/status
  - endpoints
  - persistentvolumeclaims
  - persistentvolumeclaims/status
  - persistentvolumes
  - secrets
  - serviceaccounts/token
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - operator.openyurt.io
  resources:
  - yurtclusters
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - operator.openyurt.io
  resources:
  - yurtclusters/status
  verbs:
  - get
  - patch
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: yurt-operator-proxy-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: yurt-operator-metrics-reader
rules:
- nonResourceURLs:
  - /metrics
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: yurt-operator-leader-election-rolebinding
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: yurt-operator-leader-election-role
subjects:
- kind: ServiceAccount
  name: yurt-operator-manager
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: yurt-operator-manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: yurt-operator-manager-role
subjects:
- kind: ServiceAccount
  name: yurt-operator-manager
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: yurt-operator-proxy-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: yurt-operator-proxy-role
subjects:
- kind: ServiceAccount
  name: yurt-operator-manager
  namespace: kube-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    control-plane: controller-manager
  name: yurt-operator-controller-manager-metrics-service
  namespace: kube-system
spec:
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    control-plane: controller-manager
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    control-plane: controller-manager
  name: yurt-operator-controller-manager
  namespace: kube-system
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      labels:
        control-plane: controller-manager
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/master
                operator: Exists
      containers:
      - args:
        - --yurt-agent-image=registry.cn-hangzhou.aliyuncs.com/ecp_builder/openyurt-agent:v1.0.0
        - --yurt-node-image=registry.cn-hangzhou.aliyuncs.com/ecp_builder/alpine:3.12.0
        - --yurt-agent-image-pull-policy=Always
        - --yurt-node-image-pull-policy=IfNotPresent
        - --yurt-task-health-check-timeout=5m
        command:
        - /manager
        image: registry.cn-hangzhou.aliyuncs.com/ecp_builder/openyurt-operator:v1.0.0
        imagePullPolicy: IfNotPresent
        name: manager
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 100m
            memory: 20Mi
      serviceAccountName: yurt-operator-manager
      terminationGracePeriodSeconds: 10
      tolerations:
      - operator: Exists
